"use client";
import {
  Dropdown,
  DropdownItem,
  DropdownMenu,
  DropdownTrigger,
} from "@nextui-org/dropdown";
import { Button, Listbox, ListboxItem } from "@nextui-org/react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import React, { useEffect, useState } from "react";
import arrowDown from "../../public/icon/arrowDown.svg";
import { getAllMemberInClassAction } from "@/action/memberAction";
import { getAllMembersInClassAction } from "@/action/classAction";

const DropDownSettingComponent = ({ pathName }) => {

  const [dropdown, setDropDown] = useState(false);
  function handleDropDown() {
    if (dropdown) {
      setDropDown(false);
    } else {
      setDropDown(true);
    }
  }
  const currentUrl = usePathname();

  const segments = currentUrl.split("/");

  const lastTwoSegment = segments.slice(-2);

  const lastTwoSegmentsString = lastTwoSegment.join("/");

  const lastSegment = "/" + segments.pop("/");
  console.log("las",lastTwoSegment[0]);
  const classId = lastTwoSegment[0];

  let segmentToRemove;

  {
    lastSegment == "/user"
      ? (segmentToRemove = lastTwoSegmentsString)
      : lastSegment == "/class"
      ? (segmentToRemove = lastTwoSegmentsString)
      : (segmentToRemove = lastSegment);
  }
 
  const [allMemeber,setAllMember] = useState([])
  useEffect(()=>{
    async function getMember(){
      const data = await getAllMembersInClassAction(lastTwoSegment[0])
      setAllMember(data)
    }
    getMember()
  },[])

 
  console.log("All",allMemeber);
  const teachers = allMemeber?.payload?.filter((e)=> e.isTeacher).map((e)=>e.isTeacher)
  console.log(teachers);
  return (
    <>
      {dropdown ? (
        <Listbox>
          <ListboxItem
            className={`${
              pathName == "/setting"
                ? "text-[#000] font-bold"
                : "text-inUseGray"
            } h-[40px]`}
            key="new"
            onClick={() => handleDropDown()}
          >
            <p className="flex items-center relative">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clipPath="url(#clip0_138_2589)">
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M10.0007 6.66683C9.1166 6.66683 8.26875 7.01802 7.64363 7.64314C7.01851 8.26826 6.66732 9.11611 6.66732 10.0002C6.66732 10.8842 7.01851 11.7321 7.64363 12.3572C8.26875 12.9823 9.1166 13.3335 10.0007 13.3335C10.8847 13.3335 11.7326 12.9823 12.3577 12.3572C12.9828 11.7321 13.334 10.8842 13.334 10.0002C13.334 9.11611 12.9828 8.26826 12.3577 7.64314C11.7326 7.01802 10.8847 6.66683 10.0007 6.66683ZM8.82214 8.82165C9.1347 8.50909 9.55862 8.3335 10.0007 8.3335C10.4427 8.3335 10.8666 8.50909 11.1792 8.82165C11.4917 9.13421 11.6673 9.55813 11.6673 10.0002C11.6673 10.4422 11.4917 10.8661 11.1792 11.1787C10.8666 11.4912 10.4427 11.6668 10.0007 11.6668C9.55862 11.6668 9.1347 11.4912 8.82214 11.1787C8.50958 10.8661 8.33398 10.4422 8.33398 10.0002C8.33398 9.55813 8.50958 9.13421 8.82214 8.82165Z"
                    fill="#757575"
                  />
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M9.15148 0.833496C8.77294 0.833496 8.44196 1.08863 8.3456 1.4547L7.9233 3.05904L6.5816 3.62463L5.55456 2.7109C5.2248 2.41752 4.72349 2.43214 4.4114 2.74424L2.74473 4.41091C2.44281 4.71283 2.41794 5.1941 2.68712 5.52553L3.58723 6.63379L3.03527 7.99173L1.47786 8.35532C1.10075 8.44336 0.833984 8.77958 0.833984 9.16683V10.8335C0.833984 11.2093 1.08547 11.5386 1.448 11.6374L3.05773 12.0766L3.62485 13.4219L2.71203 14.4455C2.41802 14.7752 2.43237 15.2771 2.74473 15.5894L4.4114 17.2561C4.71372 17.5584 5.1958 17.5829 5.52719 17.3127L6.63506 16.4096L7.95961 16.9545L8.35934 18.5375C8.45278 18.9076 8.78566 19.1668 9.16732 19.1668H10.834C11.2155 19.1668 11.5483 18.9078 11.6419 18.5379L12.0426 16.9542L13.4115 16.3872C13.5492 16.5027 13.7072 16.6384 13.8645 16.7753C14.0207 16.9113 14.1659 17.0395 14.2721 17.1338C14.3252 17.1809 14.3684 17.2194 14.3983 17.2461L14.4435 17.2866C14.7731 17.5822 15.2769 17.5691 15.5899 17.2561L17.2566 15.5894C17.5633 15.2827 17.5834 14.792 17.3029 14.4612L16.3951 13.3907L16.9569 12.034L18.5436 11.6217C18.9109 11.5263 19.1673 11.1947 19.1673 10.8152V9.16683C19.1673 8.78573 18.9088 8.45319 18.5394 8.35922L16.9625 7.95803L16.4023 6.60461L17.3037 5.53812C17.5834 5.20725 17.5629 4.71726 17.2566 4.41091L15.5899 2.74424C15.2823 2.43665 14.7899 2.41739 14.4592 2.70004L13.4006 3.60489L11.9995 3.02882L11.5858 1.45497C11.4895 1.08877 11.1585 0.833496 10.7798 0.833496H9.15148ZM15.5353 14.9537L14.9652 15.5238L14.9589 15.5184C14.6512 15.2504 14.2547 14.9113 14.0311 14.7514C13.7971 14.5841 13.4934 14.5493 13.2276 14.6594L11.0184 15.5744C10.7753 15.6751 10.594 15.8848 10.5294 16.1399L10.1853 17.5002H9.81638L9.47279 16.1395C9.40815 15.8835 9.22602 15.6733 8.98184 15.5728L6.81017 14.6795C6.52739 14.5632 6.20361 14.611 5.96661 14.8043L5.0576 15.5453L4.47975 14.9674L5.21927 14.1381C5.43336 13.8981 5.49016 13.5562 5.36521 13.2598L4.43604 11.0556C4.33663 10.8198 4.13437 10.6427 3.88747 10.5754L2.50065 10.197V9.82802L3.83427 9.51667C4.09773 9.45517 4.31494 9.26959 4.41681 9.01896L5.31681 6.80479C5.43128 6.52318 5.38332 6.20159 5.19168 5.96562L4.45458 5.05808L5.03405 4.47861L5.86674 5.21943C6.1068 5.433 6.44827 5.48954 6.74436 5.36472L8.94852 4.43556C9.18676 4.33513 9.36489 4.12981 9.4307 3.87979L9.79385 2.50016H10.1372L10.493 3.85369C10.5594 4.10634 10.7405 4.31322 10.9821 4.41256L13.2379 5.34006C13.5271 5.45897 13.8586 5.40596 14.0963 5.20279L14.9563 4.46767L15.5361 5.0475L14.8017 5.91637C14.6005 6.15447 14.5489 6.485 14.6682 6.77307L15.5823 8.9814C15.6829 9.22426 15.8921 9.40546 16.1468 9.47027L17.5006 9.8147V10.1707L16.1361 10.5253C15.8831 10.591 15.6757 10.7716 15.5757 11.013L14.6607 13.223C14.5412 13.5116 14.5931 13.8426 14.7951 14.0808L15.5353 14.9537Z"
                    fill="#757575"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_138_2589">
                    <rect width="20" height="20" fill="white" />
                  </clipPath>
                </defs>
              </svg>
              <span
                id="disable"
                className={`${
                  pathName == "/setting" ? "font-bold" : ""
                } absolute left-[30px]`}
              >
                Settings
              </span>
              <svg
                width="12"
                height="7"
                viewBox="0 0 12 7"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="absolute right-0"
              >
                <path
                  d="M1.42259 0.244078C1.09715 -0.0813592 0.569515 -0.0813592 0.244078 0.244078C-0.0813592 0.569515 -0.0813592 1.09715 0.244078 1.42259L5.24408 6.42259C5.56951 6.74803 6.09715 6.74803 6.42259 6.42259L11.4226 1.42259C11.748 1.09715 11.748 0.569515 11.4226 0.244078C11.0972 -0.0813592 10.5695 -0.0813592 10.2441 0.244078L5.83333 4.65482L1.42259 0.244078Z"
                  fill="#757575"
                />
              </svg>
            </p>
          </ListboxItem>
          <ListboxItem
            className={`${
              pathName == "/setting"
                ? "text-[#000] font-bold"
                : "text-inUseGray"
            } h-[40px]`}
            key="copy"
          >
            <Link
              // href={currentUrl.replace(segmentToRemove, "/setting/user")}
              // href={currentUrl.replace(lastTwoSegmentsString, "/setting/user")}
              href="/dashboard/setting/user"
              className="w-[100%] h-[100%]"
            >
              <p className="flex items-center relative">
                <svg
                  width="14"
                  height="15"
                  viewBox="0 0 14 15"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M6.66667 0C5.5616 0 4.50179 0.438987 3.72039 1.22039C2.93899 2.00179 2.5 3.0616 2.5 4.16667C2.5 5.27174 2.93899 6.33154 3.72039 7.11294C3.77536 7.16791 3.8317 7.22119 3.88934 7.27273C3.17558 7.59981 2.51848 8.05343 1.95262 8.61929C0.702379 9.86953 0 11.5652 0 13.3333V14.1667C0 14.6269 0.373096 15 0.833333 15C1.29357 15 1.66667 14.6269 1.66667 14.1667V13.3333C1.66667 12.0073 2.19345 10.7355 3.13113 9.7978C4.06881 8.86012 5.34058 8.33333 6.66667 8.33333C7.99275 8.33333 9.26452 8.86012 10.2022 9.7978C11.1399 10.7355 11.6667 12.0073 11.6667 13.3333V14.1667C11.6667 14.6269 12.0398 15 12.5 15C12.9602 15 13.3333 14.6269 13.3333 14.1667V13.3333C13.3333 11.5652 12.631 9.86953 11.3807 8.61929C10.8149 8.05343 10.1578 7.59981 9.44399 7.27273C9.50163 7.22119 9.55798 7.16791 9.61294 7.11294C10.3943 6.33154 10.8333 5.27174 10.8333 4.16667C10.8333 3.0616 10.3943 2.00179 9.61294 1.22039C8.83154 0.438987 7.77173 0 6.66667 0ZM4.8989 2.3989C5.36774 1.93006 6.00362 1.66667 6.66667 1.66667C7.32971 1.66667 7.96559 1.93006 8.43443 2.3989C8.90327 2.86774 9.16667 3.50363 9.16667 4.16667C9.16667 4.82971 8.90327 5.46559 8.43443 5.93443C7.96559 6.40327 7.32971 6.66667 6.66667 6.66667C6.00362 6.66667 5.36774 6.40327 4.8989 5.93443C4.43006 5.46559 4.16667 4.82971 4.16667 4.16667C4.16667 3.50363 4.43006 2.86774 4.8989 2.3989Z"
                    fill="#757575"
                  />
                </svg>

                <span
                  id="disable"
                  className={`${
                    pathName == "/streaming" ? "font-bold" : ""
                  } absolute left-[30px]`}
                >
                  User
                </span>
              </p>
            </Link>
          </ListboxItem>
          {pathName != "/dashboard" ? (
            pathName != "/user" ? (
              <ListboxItem
                className={`${
                  pathName == "/setting"
                    ? "text-[#000] font-bold"
                    : "text-inUseGray"
                } h-[40px]`}
                key="copy"
              >
                <Link
                  href={currentUrl.replace(segmentToRemove, "/setting/class")}
                  className="w-[100%] h-[100%]"
                >
                  <p className="flex items-center relative">
                    <svg
                      width="17"
                      height="17"
                      viewBox="0 0 17 17"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <g clipPath="url(#clip0_1_2176)">
                        <path
                          fillRule="evenodd"
                          clipRule="evenodd"
                          d="M0 0H14.639V2.36092H13.6946V0.944369H0.944453V11.8046H11.044V12.749H0V0ZM14.1668 6.1384C14.5425 6.1384 14.9029 5.98915 15.1685 5.7235C15.4342 5.45784 15.5835 5.09754 15.5835 4.72184C15.5835 4.34615 15.4342 3.98584 15.1685 3.72019C14.9029 3.45453 14.5425 3.30529 14.1668 3.30529C13.7911 3.30529 13.4307 3.45453 13.1651 3.72019C12.8994 3.98584 12.7501 4.34615 12.7501 4.72184C12.7501 5.09754 12.8994 5.45784 13.1651 5.7235C13.4307 5.98915 13.7911 6.1384 14.1668 6.1384ZM15.1259 7.08749C15.7393 7.08749 16.2248 7.36324 16.5426 7.78915C16.8396 8.18815 16.9652 8.68158 16.9935 9.13724C17.0216 9.60466 16.9579 10.0731 16.8061 10.516C16.6644 10.9268 16.425 11.3518 16.0557 11.6431V16.2904C16.056 16.4683 15.9894 16.6399 15.869 16.7709C15.7486 16.902 15.5832 16.9829 15.4059 16.9976C15.2285 17.0123 15.0521 16.9597 14.9118 16.8502C14.7714 16.7408 14.6774 16.5826 14.6485 16.407L14.0393 12.749H13.8986L13.2101 16.4207C13.1774 16.594 13.0812 16.7488 12.9404 16.855C12.7995 16.9611 12.6242 17.0109 12.4485 16.9946C12.2729 16.9783 12.1097 16.8971 11.9908 16.7669C11.8719 16.6366 11.8059 16.4667 11.8057 16.2904V9.55371C11.7112 9.69754 11.618 9.84219 11.5261 9.98764L11.4893 10.0457L11.4798 10.0608L11.4775 10.0651C11.4138 10.1673 11.3252 10.2515 11.2199 10.3099C11.1147 10.3684 10.9962 10.399 10.8759 10.3989H8.51472C8.32685 10.3989 8.14669 10.3243 8.01385 10.1915C7.88101 10.0586 7.80638 9.87849 7.80638 9.69064C7.80638 9.50279 7.88101 9.32264 8.01385 9.18981C8.14669 9.05698 8.32685 8.98236 8.51472 8.98236H10.4872C10.602 8.80482 10.7531 8.5744 10.9117 8.34302C11.077 8.10174 11.2593 7.84629 11.4217 7.64608C11.5006 7.54834 11.5889 7.44635 11.6777 7.36277C11.7211 7.32169 11.7816 7.26833 11.8552 7.22111C11.985 7.1353 12.1369 7.08903 12.2925 7.08796L15.1259 7.08749Z"
                          fill="#757575"
                        />
                      </g>
                      <defs>
                        <clipPath id="clip0_1_2176">
                          <rect width="17" height="17" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>

                    <span
                      id="disable"
                      className={`${
                        pathName == "/streaming" ? "font-bold" : ""
                      } absolute left-[30px]`}
                    >
                      Class
                    </span>
                  </p>
                </Link>
              </ListboxItem>
            ) : (
              ""
            )
          ) : (
            ""
          )}
        </Listbox>
      ) : (
        <Listbox aria-label="Actions">
          <ListboxItem
            className={`${
              pathName == "/setting"
                ? "text-[#000] font-bold"
                : "text-inUseGray"
            } h-[40px]`}
            key="new"
            onClick={() => handleDropDown()}
          >
            <p className="flex items-center relative">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clipPath="url(#clip0_138_2589)">
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M10.0007 6.66683C9.1166 6.66683 8.26875 7.01802 7.64363 7.64314C7.01851 8.26826 6.66732 9.11611 6.66732 10.0002C6.66732 10.8842 7.01851 11.7321 7.64363 12.3572C8.26875 12.9823 9.1166 13.3335 10.0007 13.3335C10.8847 13.3335 11.7326 12.9823 12.3577 12.3572C12.9828 11.7321 13.334 10.8842 13.334 10.0002C13.334 9.11611 12.9828 8.26826 12.3577 7.64314C11.7326 7.01802 10.8847 6.66683 10.0007 6.66683ZM8.82214 8.82165C9.1347 8.50909 9.55862 8.3335 10.0007 8.3335C10.4427 8.3335 10.8666 8.50909 11.1792 8.82165C11.4917 9.13421 11.6673 9.55813 11.6673 10.0002C11.6673 10.4422 11.4917 10.8661 11.1792 11.1787C10.8666 11.4912 10.4427 11.6668 10.0007 11.6668C9.55862 11.6668 9.1347 11.4912 8.82214 11.1787C8.50958 10.8661 8.33398 10.4422 8.33398 10.0002C8.33398 9.55813 8.50958 9.13421 8.82214 8.82165Z"
                    fill="#757575"
                  />
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M9.15148 0.833496C8.77294 0.833496 8.44196 1.08863 8.3456 1.4547L7.9233 3.05904L6.5816 3.62463L5.55456 2.7109C5.2248 2.41752 4.72349 2.43214 4.4114 2.74424L2.74473 4.41091C2.44281 4.71283 2.41794 5.1941 2.68712 5.52553L3.58723 6.63379L3.03527 7.99173L1.47786 8.35532C1.10075 8.44336 0.833984 8.77958 0.833984 9.16683V10.8335C0.833984 11.2093 1.08547 11.5386 1.448 11.6374L3.05773 12.0766L3.62485 13.4219L2.71203 14.4455C2.41802 14.7752 2.43237 15.2771 2.74473 15.5894L4.4114 17.2561C4.71372 17.5584 5.1958 17.5829 5.52719 17.3127L6.63506 16.4096L7.95961 16.9545L8.35934 18.5375C8.45278 18.9076 8.78566 19.1668 9.16732 19.1668H10.834C11.2155 19.1668 11.5483 18.9078 11.6419 18.5379L12.0426 16.9542L13.4115 16.3872C13.5492 16.5027 13.7072 16.6384 13.8645 16.7753C14.0207 16.9113 14.1659 17.0395 14.2721 17.1338C14.3252 17.1809 14.3684 17.2194 14.3983 17.2461L14.4435 17.2866C14.7731 17.5822 15.2769 17.5691 15.5899 17.2561L17.2566 15.5894C17.5633 15.2827 17.5834 14.792 17.3029 14.4612L16.3951 13.3907L16.9569 12.034L18.5436 11.6217C18.9109 11.5263 19.1673 11.1947 19.1673 10.8152V9.16683C19.1673 8.78573 18.9088 8.45319 18.5394 8.35922L16.9625 7.95803L16.4023 6.60461L17.3037 5.53812C17.5834 5.20725 17.5629 4.71726 17.2566 4.41091L15.5899 2.74424C15.2823 2.43665 14.7899 2.41739 14.4592 2.70004L13.4006 3.60489L11.9995 3.02882L11.5858 1.45497C11.4895 1.08877 11.1585 0.833496 10.7798 0.833496H9.15148ZM15.5353 14.9537L14.9652 15.5238L14.9589 15.5184C14.6512 15.2504 14.2547 14.9113 14.0311 14.7514C13.7971 14.5841 13.4934 14.5493 13.2276 14.6594L11.0184 15.5744C10.7753 15.6751 10.594 15.8848 10.5294 16.1399L10.1853 17.5002H9.81638L9.47279 16.1395C9.40815 15.8835 9.22602 15.6733 8.98184 15.5728L6.81017 14.6795C6.52739 14.5632 6.20361 14.611 5.96661 14.8043L5.0576 15.5453L4.47975 14.9674L5.21927 14.1381C5.43336 13.8981 5.49016 13.5562 5.36521 13.2598L4.43604 11.0556C4.33663 10.8198 4.13437 10.6427 3.88747 10.5754L2.50065 10.197V9.82802L3.83427 9.51667C4.09773 9.45517 4.31494 9.26959 4.41681 9.01896L5.31681 6.80479C5.43128 6.52318 5.38332 6.20159 5.19168 5.96562L4.45458 5.05808L5.03405 4.47861L5.86674 5.21943C6.1068 5.433 6.44827 5.48954 6.74436 5.36472L8.94852 4.43556C9.18676 4.33513 9.36489 4.12981 9.4307 3.87979L9.79385 2.50016H10.1372L10.493 3.85369C10.5594 4.10634 10.7405 4.31322 10.9821 4.41256L13.2379 5.34006C13.5271 5.45897 13.8586 5.40596 14.0963 5.20279L14.9563 4.46767L15.5361 5.0475L14.8017 5.91637C14.6005 6.15447 14.5489 6.485 14.6682 6.77307L15.5823 8.9814C15.6829 9.22426 15.8921 9.40546 16.1468 9.47027L17.5006 9.8147V10.1707L16.1361 10.5253C15.8831 10.591 15.6757 10.7716 15.5757 11.013L14.6607 13.223C14.5412 13.5116 14.5931 13.8426 14.7951 14.0808L15.5353 14.9537Z"
                    fill="#757575"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_138_2589">
                    <rect width="20" height="20" fill="white" />
                  </clipPath>
                </defs>
              </svg>
              <span
                id="disable"
                className={`${
                  pathName == "/setting" ? "font-bold" : ""
                } absolute left-[30px]`}
              >
                Settings
              </span>
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                className="absolute right-0"
              >
                <path
                  d="M5.52876 11.5284C5.26841 11.7888 5.26841 12.2109 5.52876 12.4712C5.78911 12.7316 6.21122 12.7316 6.47157 12.4712L10.4716 8.47124C10.7319 8.21089 10.7319 7.78878 10.4716 7.52843L6.47157 3.52843C6.21122 3.26808 5.78911 3.26808 5.52876 3.52843C5.26841 3.78878 5.26841 4.21089 5.52876 4.47124L9.05735 7.99984L5.52876 11.5284Z"
                  fill="#757575"
                />
              </svg>
            </p>
          </ListboxItem>
        </Listbox>
      )}
    </>
  );
};

export default DropDownSettingComponent;
